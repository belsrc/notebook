---
tags:
  - rust
gardening: ðŸŒ¿
---
## Rust Compiler

`rustc` is the provided compiler for the Rust language. It is the program that will convert your `.rs` files into executables. It also containers the linter used for Rust files. When `rustc` compiles your code, it will also run the lints.

---
### Basic Use

Given the simple Rust file:

```rust
fn main() {
  println!("Hello, world!");
}
```

In order to compile and run this file, you would use:

```
rustc hello.rs
```

> [!note]
> You only ever passÂ `rustc`Â theÂ _crate root_, not every file we wish to compile.

---
### Command Line Flags

 `-h`/`--help`
Â Â Â Â This flag will print out help information forÂ `rustc`.

`--cfg`
Â Â Â Â This flag can turn on or off variousÂ `#[cfg]`Â settings forÂ conditional compilation. 

`--crate-type`
Â Â Â Â This instructsÂ `rustc`Â on which crate type to build. This flag accepts a comma-separated list of values, and may be specified multiple times. The valid crate types are:

- `lib`Â â€” Generates a library kind preferred by the compiler, currently defaults toÂ `rlib`.
- `rlib`Â â€” A Rust static library.
- `staticlib`Â â€” A native static library.
- `dylib`Â â€” A Rust dynamic library.
- `cdylib`Â â€” A native dynamic library.
- `bin`Â â€” A runnable executable program.
- `proc-macro`Â â€” Generates a format suitable for a procedural macro library that may be loaded by the compiler.

`--crate-name`
Â Â Â Â This informsÂ `rustc`Â of the name of your crate.

`--edition`
Â Â Â Â This flag takes a value ofÂ `2015`,Â `2018`Â orÂ `2021`. The default isÂ `2015`.

- Rust `2015` has a theme of _"stability"_. It commenced with the release of 1.0, and is the "default edition".
- Rust `2018`, the edition system was created for this release. This coincided with a number of other features all coordinated around the theme ofÂ _"productivity"_.
- Rust `2021` Edition contains several changes that bring new capabilities and more consistency to the language, and opens up room for expansion in the future.

`--emit`
Â Â Â Â This flag controls the types of output files generated by the compiler. It accepts a comma-separated list of values, and may be specified multiple times. The valid emit kinds are:

- `asm`Â â€” Generates a file with the crate's assembly code. The default output filename isÂ `CRATE_NAME.s`.
- `dep-info`Â â€” Generates a file with Makefile syntax that indicates all the source files that were loaded to generate the crate. The default output filename isÂ `CRATE_NAME.d`.
- `link`Â â€” Generates the crates specified byÂ `--crate-type`. The default output filenames depend on the crate type and platform. This is the default ifÂ `--emit`Â is not specified.
- `llvm-bc`Â â€” Generates a binary file containing theÂ LLVM bitcode. The default output filename isÂ `CRATE_NAME.bc`.
- `llvm-ir`Â â€” Generates a file containingÂ LLVM IR. The default output filename isÂ `CRATE_NAME.ll`.
- `metadata`Â â€” Generates a file containing metadata about the crate. The default output filename isÂ `libCRATE_NAME.rmeta`.
- `mir`Â â€” Generates a file containing rustc's mid-level intermediate representation. The default output filename isÂ `CRATE_NAME.mir`.
- `obj`Â â€” Generates a native object file. The default output filename isÂ `CRATE_NAME.o`.

`--print`
Â Â Â Â This flag prints out various information about the compiler. This flag may be specified multiple times, and the information is printed in the order the flags are specified. Specifying aÂ `--print`Â flag will usually disable theÂ `--emit`Â step and will only print the requested information.

- `crate-name`Â â€” The name of the crate.
- `file-names`Â â€” The names of the files created by theÂ `link`Â emit kind.
- `sysroot`Â â€” Path to the sysroot.
- `target-libdir`Â - Path to the target libdir.
- `cfg`Â â€” List of cfg values. SeeÂ conditional compilationÂ for more information about cfg values.
- _Check docs for full list_

`-g`
Â Â Â Â A synonym forÂ `-C debuginfo=2`.

`-O`
Â Â Â Â A synonym forÂ `-C opt-level=2`.

`-o`
Â Â Â Â This flag controls the output filename.

`--out-dir`
Â Â Â Â The outputted crate will be written to this directory. This flag is ignored if theÂ `-o`Â flagÂ is used.

`--explain`
Â Â Â Â Each error ofÂ `rustc`'s comes with an error code; this will print out a longer explanation of a given error.

`--test`
Â Â Â Â When compiling this crate,Â `rustc`Â will ignore yourÂ `main`Â function and instead produce a test harness.

`--target`
Â Â Â Â This controls whichÂ targetÂ to produce.

`-v`/`--verbose`
Â Â Â Â This flag, when combined with other flags, makes them produce extra output.


> [!note]
> For a full list check the [documentation](https://doc.rust-lang.org/rustc/command-line-arguments.html).

---

## `rustup` CLI

`rustup`Â is aÂ _toolchain multiplexer_. It installs and manages many Rust toolchains and presents them all through a single set of tools. Rust is distributed on three differentÂ release channels: `stable`, `beta`, and `nightly`.Â `rustup`Â uses the stable channel by default, which represents the latest release of Rust.

When a new version of Rust is released, enter:

```
rustup update
```

This will update the various toolchains as well as self-update.

```
info: syncing channel updates for 'stable'
info: downloading component 'rustc'
info: downloading component 'rust-std'
info: downloading component 'rust-docs'
info: downloading component 'cargo'
info: installing component 'rustc'
info: installing component 'rust-std'
info: installing component 'rust-docs'
info: installing component 'cargo'
info: checking for self-update
info: downloading self-update
```

---

## Cargo

Cargo is theÂ RustÂ _package manager_. Cargo downloads your RustÂ packageâ€™s dependencies, compiles your packages, makes distributable packages, and uploads them toÂ [crates.io](https://crates.io/), the Rust communityâ€™sÂ _package registry_.

---
### New Cargo Project.

To create a new Rust project using Cargo simply run the command:

```
cargo new <proj name>
```

This will create a new directory with the given name. Inside that directory will be a few files/folders. 
- `Cargo.toml` - Cargo's manifest file.
- `src` directory containing a `main.rs` file.

It will also initialize a new Git repository in the directory. As well as a `.gitignore`. The Git will be skipped if the directory that you are starting the project in in is an existing Git repository already.

---
### Manifest `toml`

Inside the manifest file there are a few sections. Denoted by `[<name>]`.  These describe various aspects of the Rust project and how certain things should be carried out.

`[package]` - Contains various information such as the name of the package (`name`),  the version of the package (`version`) and the Rust edition to use (`edition`).

`[dependencies]` - The list of the dependencies the Rust package requires.

> [!note]
> For the entire list, visit the [documentation](https://doc.rust-lang.org/cargo/reference/manifest.html).

---
### Folder Structure

Cargo uses conventions for file placement to make it easy to dive into a new CargoÂ package:

```
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚Â Â  â”œâ”€â”€ lib.rs
â”‚Â Â  â”œâ”€â”€ main.rs
â”‚Â Â  â””â”€â”€ bin/
â”‚       â”œâ”€â”€ named-executable.rs
â”‚Â Â   Â Â  â”œâ”€â”€ another-executable.rs
â”‚Â Â   Â Â  â””â”€â”€ multi-file-executable/
â”‚Â Â   Â Â      â”œâ”€â”€ main.rs
â”‚Â Â   Â Â      â””â”€â”€ some_module.rs
â”œâ”€â”€ benches/
â”‚Â Â  â”œâ”€â”€ large-input.rs
â”‚Â Â  â””â”€â”€ multi-file-bench/
â”‚Â Â      â”œâ”€â”€ main.rs
â”‚Â Â      â””â”€â”€ bench_module.rs
â”œâ”€â”€ examples/
â”‚Â Â  â”œâ”€â”€ simple.rs
â”‚Â Â  â””â”€â”€ multi-file-example/
â”‚Â Â      â”œâ”€â”€ main.rs
â”‚Â Â      â””â”€â”€ ex_module.rs
â””â”€â”€ tests/
     â”œâ”€â”€ some-integration-tests.rs
     â””â”€â”€ multi-file-test/
         â”œâ”€â”€ main.rs
         â””â”€â”€ test_module.rs
```

- `Cargo.toml`Â andÂ `Cargo.lock`Â are stored in the root of your package (_package root_).
- Source code goes in theÂ `src`Â directory.
- The default library file isÂ `src/lib.rs`.
- The default executable file isÂ `src/main.rs`.
    - Other executables can be placed inÂ `src/bin/`.
- Benchmarks go in theÂ `benches`Â directory.
- Examples go in theÂ `examples`Â directory.
- Integration tests go in theÂ `tests`Â directory.

---
### Cargo `build`, `run` and `check`

The `cargo build` command will compile and executable for your source files. This usually placed in the `target/debug` directory. Which then can be ran like any other executable in the terminal.

As this is a common pattern, and tedious to do every time we want to check the application, another command is provided. `cargo run` , like `build`, will build the executable. But will also run it when the build is finished.

Since Rust is a compiled language, sometimes we just want to make sure that it _can_ compile without actually producing the binary file. In order to facilitate that, there is the `cargo check` command. This is also much faster as it skips the aforementioned build step.

---
### Release Build

When you are ready, you can have Rust compile a release quality build using the `--release` flag.

```
cargo build --release
```

This compiles the executable with optimizations. This will make the application itself run faster but causes the build step to take longer than the "debug" version.

---
### Common Cargo commands.

`cargo bench`
Â Â Â Â Execute benchmarks of a package.

`cargo build`
Â Â Â Â Compile a package.

  `cargo check`
Â Â Â Â Check a local package and all of its dependencies for errors.

`cargo clean`
Â Â Â Â Remove artifacts that Cargo has generated in the past.

`cargo doc`
Â Â Â Â Build a packageâ€™s documentation.

`cargo fetch`
Â Â Â Â Fetch dependencies of a package from the network.

`cargo fix`
Â Â Â Â Automatically fix lint warnings reported by rustc.

`cargo run`
Â Â Â Â Run a binary or example of the local package.

`cargo rustc`
Â Â Â Â Compile a package, and pass extra options to the compiler.

`cargo test`
Â Â Â Â Execute unit and integration tests of a package.

`cargo generate-lockfile`
Â Â Â Â GenerateÂ `Cargo.lock`Â for a project.

`cargo tree`
Â Â Â Â Display a tree visualization of a dependency graph.

`cargo update`
Â Â Â Â Update dependencies as recorded in the local lock file.

`cargo verify-project`
Â Â Â Â Check correctness of crate manifest.

`cargo init`
Â Â Â Â Create a new Cargo package in an existing directory.
 
`cargo install`
Â Â Â Â Build and install a Rust binary.

`cargo new`
Â Â Â Â Create a new Cargo package.

`cargo search`
Â Â Â Â Search packages in crates.io.

`cargo uninstall`
Â Â Â Â Remove a Rust binary.

`cargo package`
Â Â Â Â Assemble the local package into a distributable tarball.

`cargo publish`
Â Â Â Â Upload a package to the registry.

`cargo help`
Â Â Â Â Display help information about Cargo.

`cargo version`
Â Â Â Â Show version information.

> [!note]
> For a full list with detailed descriptions and options, check the [documentation](https://doc.rust-lang.org/cargo/commands/cargo.html).

---
